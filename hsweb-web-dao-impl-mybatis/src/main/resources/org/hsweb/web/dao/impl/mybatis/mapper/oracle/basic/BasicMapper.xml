<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BasicMapper">
    <!--通用查询条件-->
    <sql id="buildWhere">
        ${@org.hsweb.web.mybatis.builder.DefaultSqlParamBuilder@instance().buildWhere($fieldsInfo,$tableName,#this['_parameter'].terms)}
    </sql>
    <!--生成查询字段-->
    <sql id="buildSelectField">
        ${@org.hsweb.web.mybatis.builder.DefaultSqlParamBuilder@instance().buildSelectFields($fieldsInfo,$tableName,#this['_parameter'])}
    </sql>

    <!--生成修改字段-->
    <sql id="buildUpdateField">
        <set>
        ${@org.hsweb.web.mybatis.builder.MysqlParamBuilder@instance().buildUpdateFields($fieldsInfo,#this['_parameter'])}
        </set>
    </sql>

    <!--生成插入字段-->
    <sql id="buildInsertField">
        <foreach item="item" index="index" collection="$fields" open="(" separator="," close=")">${item}</foreach>
    </sql>

    <!--生成插入值-->
    <sql id="buildInsertValues">
        <foreach item="item" index="index" collection="$fields" open="(" separator="," close=")">
            #{data.${$fieldsInfo[item].property==null?item:$fieldsInfo[item].property},jdbcType=${$fieldsInfo[item]['jdbcType']},javaType=${$fieldsInfo[item]['javaType']}}
        </foreach>
    </sql>

    <!--生成排序字段-->
    <sql id="buildSortField">
        ${@org.hsweb.web.mybatis.builder.DefaultSqlParamBuilder@instance().buildOrder($fieldsInfo,$tableName,#this['_parameter'])}
    </sql>

    <!--生成查询sql-->
    <sql id="buildSelectSql">
        select
        <include refid="BasicMapper.buildSelectField"/>
        from ${$tableName}
        <where>
            <include refid="BasicMapper.buildWhere"/>
        </where>
        <include refid="BasicMapper.buildSortField"/>
    </sql>

    <!--生成InsertSql-->
    <sql id="buildInsertSql">
        insert into ${$tableName}
        <include refid="BasicMapper.buildInsertField"/>
        values
        <include refid="BasicMapper.buildInsertValues"/>
    </sql>

    <!--生成UpdateSql-->
    <sql id="buildUpdateSql">
        update ${$tableName}
        <include refid="BasicMapper.buildUpdateField"/>
        <where>
            <include refid="BasicMapper.buildWhere"/>
            <if test="terms.size()==0">
                u_id=#{data.id}
            </if>
        </where>
    </sql>

    <!--生成查询数量sql-->
    <sql id="buildTotalSql">
        select count(0) as "total" from ${$tableName}
        <where>
            <include refid="BasicMapper.buildWhere"/>
        </where>
    </sql>
</mapper>
